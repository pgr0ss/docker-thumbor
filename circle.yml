machine:
  ruby:
    version: 2.2.0
  services:
    - docker

dependencies:
  override:
    - bundle install
    - make build
    - docker images -a

test:
  override:
    - docker run -d -p 9000:9000 $(make repo):$(make version)
    - make test

deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - make tag_latest
      - make release
